    <!DOCTYPE html>
    <html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Mi Perfil - Fashion Boutique</title>

        <!-- Bootstrap 5 -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

        <style>
            body { background-color: #f6f7fb; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
            .profile-card { border-radius: 12px; box-shadow: 0 6px 18px rgba(10,10,10,0.06); border: none; }
            .product-card { transition: transform .12s ease, box-shadow .12s ease; }
            .product-card:hover { transform: translateY(-6px); box-shadow: 0 12px 30px rgba(10,10,10,0.08); }
            .text-truncate-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
            .cart-count { position: absolute; top: -8px; right: -8px; background: #dc3545; color: #fff; width: 20px; height: 20px; border-radius: 50%; font-size: 12px; display:flex; align-items:center; justify-content:center; }
            footer { background:#111827; color:#fff; }
        </style>
    </head>
    <body>
        <!-- NAVBAR -->
        <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
            <div class="container">
                <a class="navbar-brand fw-bold" href="{{ url_for('auth.home') }}">FASHION BOUTIQUE</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navMenu">
                    <ul class="navbar-nav ms-auto align-items-center">
                        <li class="nav-item me-2">
                            <a class="nav-link" href="{{ url_for('auth.home') }}">Inicio</a>
                        </li>
                        <li class="nav-item me-2">
                            <a class="nav-link active" href="{{ url_for('users.profile') }}">Mi Perfil</a>
                        </li>
                        <li class="nav-item position-relative me-2">
                            <a class="nav-link" href="#" id="cartButton"><i class="fas fa-shopping-cart"></i></a>
                            <span class="cart-count" id="cartCount">0</span>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('auth.logout') }}">Cerrar Sesión</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- CART SLIDE PANEL -->
        <div class="overlay" id="cartOverlay" style="display:none;"></div>
        <div id="cartModal" style="position:fixed; right:0; top:0; bottom:0; width:380px; transform:translateX(100%); transition:transform .25s ease; background:#fff; z-index:2000; box-shadow: -10px 0 30px rgba(0,0,0,0.12);">
            <div class="p-3 border-bottom d-flex justify-content-between align-items-center">
                <strong>Tu carrito</strong>
                <button class="btn btn-sm btn-outline-secondary" id="closeCart"><i class="fas fa-times"></i></button>
            </div>
            <div id="cartItems" class="p-3" style="height:calc(100vh - 220px); overflow:auto;">
                <div id="emptyCartMessage" class="text-center text-muted py-5">
                    <i class="fas fa-shopping-cart fa-3x mb-2"></i>
                    <p>Tu carrito está vacío</p>
                </div>
            </div>
            <div class="p-3 border-top">
                <div class="d-flex justify-content-between mb-2">
                    <span>Subtotal</span>
                    <strong id="cartSubtotal">$0.00</strong>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span>Envío</span>
                    <span>Gratis</span>
                </div>
                <hr>
                <div class="d-flex justify-content-between mb-3">
                    <strong>Total</strong>
                    <strong id="cartTotal">$0.00</strong>
                </div>
                <button class="btn btn-dark w-100 mb-2" id="checkoutButton">Proceder al pago</button>
                <button class="btn btn-outline-danger w-100" id="clearCartButton">Vaciar carrito</button>
            </div>
        </div>

        <!-- CONTENIDO -->
        <div class="container mt-4">
            <div class="row">
                <!-- SIDEBAR PERFIL -->
                <div class="col-lg-4 mb-4">
                    <div class="card profile-card mb-3">
                        <div class="card-body text-center">
                            <img src="https://ui-avatars.com/api/?name={{ username }}&background=000&color=ffffff&size=120" class="rounded-circle mb-3" width="110" height="110" alt="avatar">
                            <h4 class="mb-0">{{ username }}</h4>
                            <small class="text-muted d-block mb-2">{{ current_user.emailUser }}</small>
                            <span class="badge bg-success">Cuenta Activa</span>

                            <div class="mt-3 d-grid gap-2">
                                <a href="{{ url_for('users.edit_profile') }}" class="btn btn-outline-primary btn-sm"><i class="fas fa-edit me-1"></i>Editar perfil</a>
                                <a href="{{ url_for('users.change_password') }}" class="btn btn-outline-secondary btn-sm"><i class="fas fa-lock me-1"></i>Cambiar contraseña</a>
                            </div>
                        </div>
                    </div>

                    <div class="card profile-card">
                        <div class="card-body">
                            <h6>Información</h6>
                            <hr>
                            <p class="mb-1"><i class="fas fa-user me-2"></i><strong>Rol:</strong> {{ role_label }}</p>
                            <p class="mb-1"><i class="fas fa-envelope me-2"></i><strong>Email:</strong> {{ current_user.emailUser }}</p>
                            <p class="mb-0"><i class="fas fa-calendar me-2"></i><strong>Miembro desde:</strong>
                                {% if current_user.created_at %}
                                    {{ current_user.created_at.strftime('%d/%m/%Y') }}
                                {% else %}
                                    Fecha no disponible
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>

                <!-- MAIN -->
                <div class="col-lg-8">
                    <div class="mb-3">
                        <h3 class="mb-1">Bienvenido, {{ username }} 👋</h3>
                        <p class="text-muted mb-0">Explora nuestros productos destacados.</p>
                    </div>

                
                    <!-- PRODUCTOS -->
                    <h5 class="mb-3">Productos Destacados</h5>
                    <div class="row" id="products-container">
                        {% if products and products|length > 0 %}
                            {% for product in products %}
                            <div class="col-md-6 col-lg-4 mb-3">
                                <div class="card product-card h-100">
                                    <img src="{{ product.image_url }}" class="card-img-top" alt="{{ product.name }}" style="height:260px; object-fit:cover;">
                                    <div class="card-body d-flex flex-column">
                                        <h6 class="card-title mb-1">{{ product.name }}</h6>
                                        <p class="card-text text-muted mb-2 text-truncate-3" style="font-size:0.92rem;">{{ product.description }}</p>
                                        <div class="mt-auto d-flex justify-content-between align-items-center">
                                            <div>
                                                <span class="fw-bold">${{ '%.2f'|format(product.price) }}</span>
                                                <small class="d-block text-muted">Stock: {{ product.stock }}</small>
                                            </div>
                                            <button class="btn btn-sm btn-outline-primary add-to-cart"
                                                    data-id="{{ product.id }}"
                                                    data-name="{{ product.name }}"
                                                    data-price="{{ product.price }}"
                                                    data-image="{{ product.image_url }}">
                                                <i class="fas fa-cart-plus me-1"></i>Agregar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="col-12">
                                <div class="alert alert-info">No hay productos disponibles.</div>
                            </div>
                        {% endif %}
                    </div>

                    <!-- DETALLES DE CUENTA -->
                    <div class="card profile-card mt-4">
                        <div class="card-body">
                            <h6>Detalles de tu cuenta</h6>
                            <hr>
                            <div class="row">
                                <div class="col-md-6">
                                    <p class="mb-1"><strong>Nombre:</strong> {{ username }}</p>
                                    <p class="mb-1"><strong>Email:</strong> {{ current_user.emailUser }}</p>
                                    <p class="mb-0"><strong>Estado:</strong> <span class="badge bg-success">Activa</span></p>
                                </div>
                                <div class="col-md-6">
                                    <p class="mb-1"><strong>Rol:</strong> {{ role_label }}</p>
                                    <p class="mb-0"><strong>Último acceso:</strong> Ahora</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div> <!-- fin main -->
            </div>
        </div>

        <footer class="py-4 mt-5">
            <div class="container text-center">
                <small class="text-muted">© 2025 Fashion Boutique. Todos los derechos reservados.</small>
            </div>
        </footer>

        <!-- SCRIPTS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <script>
        document.addEventListener('DOMContentLoaded', function () {
            let cart = [];
            const cartModal = document.getElementById('cartModal');
            const cartOverlay = document.getElementById('cartOverlay');
            const cartButton = document.getElementById('cartButton');
            const closeCart = document.getElementById('closeCart');
            const cartItems = document.getElementById('cartItems');
            const cartCount = document.getElementById('cartCount');
            const cartSubtotal = document.getElementById('cartSubtotal');
            const cartTotal = document.getElementById('cartTotal');
            const emptyCartMessage = document.getElementById('emptyCartMessage');
            const checkoutButton = document.getElementById('checkoutButton');
            const clearCartButton = document.getElementById('clearCartButton');

            // Cargar carrito de localStorage
            if (localStorage.getItem('cart')) {
                try {
                    cart = JSON.parse(localStorage.getItem('cart')) || [];
                } catch (e) {
                    cart = [];
                    localStorage.removeItem('cart');
                }
            }
            updateCart();

            // Abrir/cerrar carrito
            function openCart() {
                cartModal.style.transform = 'translateX(0)';
                cartOverlay.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
            function closeCartModal() {
                cartModal.style.transform = 'translateX(100%)';
                cartOverlay.style.display = 'none';
                document.body.style.overflow = '';
            }

            document.querySelectorAll('.add-to-cart').forEach(btn => {
                btn.addEventListener('click', function () {
                    const id = String(this.dataset.id);
                    const name = this.dataset.name;
                    const price = parseFloat(this.dataset.price) || 0;
                    const image = this.dataset.image || '';

                    addToCart(id, name, price, image);
                    // feedback visual
                    const original = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-check"></i> Agregado';
                    this.classList.remove('btn-outline-primary');
                    this.classList.add('btn-success');
                    setTimeout(() => {
                        this.innerHTML = original;
                        this.classList.remove('btn-success');
                        this.classList.add('btn-outline-primary');
                    }, 1200);
                });
            });

            cartButton.addEventListener('click', function(e){
                e.preventDefault();
                openCart();
            });
            closeCart.addEventListener('click', closeCartModal);
            cartOverlay.addEventListener('click', closeCartModal);

            checkoutButton.addEventListener('click', function(){
                if (cart.length === 0) {
                    alert('Tu carrito está vacío');
                    return;
                }
                alert('Compra simulada. Total: ' + cartTotal.textContent);
                clearCart();
                closeCartModal();
            });

            clearCartButton.addEventListener('click', function(){
                if (confirm('¿Vaciar carrito?')) clearCart();
            });

            function addToCart(id, name, price, image) {
                const existing = cart.find(i => i.id === id);
                if (existing) existing.quantity++;
                else cart.push({ id, name, price, image, quantity: 1 });
                saveCart();
                updateCart();
            }

            function updateCart() {
                // contador
                const totalItems = cart.reduce((s, it) => s + it.quantity, 0);
                cartCount.textContent = totalItems;

                // items
                if (cart.length === 0) {
                    emptyCartMessage.style.display = 'block';
                    cartSubtotal.textContent = '$0.00';
                    cartTotal.textContent = '$0.00';
                    // limpiar contenedor sin eliminar emptyCartMessage
                    cartItems.innerHTML = '';
                    cartItems.appendChild(emptyCartMessage);
                    return;
                }

                emptyCartMessage.style.display = 'none';

                let html = '';
                let subtotal = 0;
                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    subtotal += itemTotal;
                    html += `
                        <div class="cart-item p-2 border-bottom">
                            <div class="d-flex align-items-center">
                                <img src="${item.image}" width="60" height="60" style="object-fit:cover; border-radius:6px;" class="me-3">
                                <div class="flex-grow-1">
                                    <strong>${item.name}</strong>
                                    <div class="small text-muted">$${item.price.toFixed(2)} c/u</div>
                                    <div class="mt-2">
                                        <button class="btn btn-sm btn-outline-secondary decrease-qty" data-id="${item.id}">-</button>
                                        <span class="px-2">${item.quantity}</span>
                                        <button class="btn btn-sm btn-outline-secondary increase-qty" data-id="${item.id}">+</button>
                                    </div>
                                </div>
                                <div class="text-end">
                                    <div><strong>$${itemTotal.toFixed(2)}</strong></div>
                                    <button class="btn btn-link btn-sm text-danger remove-item" data-id="${item.id}"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>
                    `;
                });

                cartItems.innerHTML = html;
                cartSubtotal.textContent = `$${subtotal.toFixed(2)}`;
                cartTotal.textContent = `$${subtotal.toFixed(2)}`;

                // listeners dinámicos
                document.querySelectorAll('.decrease-qty').forEach(b => {
                    b.addEventListener('click', () => {
                        updateQuantity(b.dataset.id, -1);
                    });
                });
                document.querySelectorAll('.increase-qty').forEach(b => {
                    b.addEventListener('click', () => {
                        updateQuantity(b.dataset.id, 1);
                    });
                });
                document.querySelectorAll('.remove-item').forEach(b => {
                    b.addEventListener('click', () => {
                        removeFromCart(b.dataset.id);
                    });
                });
            }

            function updateQuantity(id, delta) {
                const it = cart.find(i => i.id === id);
                if (!it) return;
                it.quantity += delta;
                if (it.quantity <= 0) {
                    removeFromCart(id);
                } else {
                    saveCart();
                    updateCart();
                }
            }

            function removeFromCart(id) {
                cart = cart.filter(i => i.id !== id);
                saveCart();
                updateCart();
            }

            function clearCart() {
                cart = [];
                saveCart();
                updateCart();
            }

            function saveCart() {
                localStorage.setItem('cart', JSON.stringify(cart));
            }
        });
        </script>
    </body>
    </html>
